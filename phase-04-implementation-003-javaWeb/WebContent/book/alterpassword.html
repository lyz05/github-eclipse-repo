<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<title>修改密码 - 图书借阅管理系统</title>
	<!-- bootstrap样式 -->
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="/static/jquery.min.js"></script>
</head>

<body>
	<div align="center">
		<h1>修改密码</h1>
		<form id="form1" method="post">
			<p><label>读者号：</label><input id="username" name="username" type="text" value=""><br></p>
			<p><label>旧密码：</label><input name="pwd" type="password"><br></p>
			<p><label>新密码：</label><input name="newpwd" type="password"><br></p>
			<p><input type="button" value="修改密码" class="btn btn-primary" onclick="alterpwd()"/></p>
		</form>
	</div>
	<script>
		//发送ajax请求，成功刷新当前页面
		function ajaxRequest(type, url, data, href) {
	        $.ajax({
				url: url,
				type: type,
				dataType: "json",
				data: data,
				success:function(result,testStatus)
				{
					alert(result.message);
					if (result.code=="200"){
						window.location.href = href;
					}
					if (result.code=="601") {
						window.location.href='./';
					}
				},
				error:function(xhr,errorMessage,e)
				{
					alert("发送请求失败，请检查网络状态");
				}
			});
		}
		function alterpwd(){
			ajaxRequest("post","api/psdalter",$('#form1').serialize(),window.location.href);
		}
		function GetQueryString(name)
		{
		     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		     var r = window.location.search.substr(1).match(reg);
		     if(r!=null) return  unescape(r[2]); return null;
		}
		$('#username').val(GetQueryString('username'));
	</script>
</body>
</html>